/**
 * MidiLeds v1.0 - https://github.com/hhromic/midi-leds-js
 * An ADSR-based polyphonic MIDI LEDs display for JavaScript.
 * MIT license
 * Hugo Hromic - http://github.com/hhromic
 *
 * @license
 */
(function(){"use strict";function e(i,s,a,e,n){this._leds=i,this._noteMin=127&s,this._noteMax=127&a,this._numVoices=e,this._midiColors=n,this._voices=new Array(e);for(var t=e;t--;)this._voices[t]={channel:0,note:0,hsv8:[0,0,0],adsrEnvelope:new AdsrEnvelope,age:0};this._activeVoices=0,this._parameters=new Array(16);for(var t=16;t--;)this.reset(t)}var i={attackTime:80,decayTime:3e3,sustainLevel:0,releaseTime:400,baseBrightness:0,enabled:!0},t=e.prototype;t._getVoiceIndex=function(s,a){for(var e=void 0,i=void 0,t=this._numVoices;t--;){if(this._voices[t].channel==s&&this._voices[t].note==a)return t;(void 0===i||this._voices[t].adsrEnvelope.isIdle())&&(i=t),(void 0===e||this._voices[t].age>this._voices[e].age)&&(e=t)}return void 0!==i?i:e},t._moveVoice=function(e){for(var i=this._voices[e],t=e;t--;)this._voices[t+1]=this._voices[t];this._voices[0]=i},t._findVoiceIndex=function(e,i){for(var t=this._numVoices;t--;)if(this._voices[t].channel==e&&this._voices[t].note==i&&!this._voices[t].adsrEnvelope.isIdle())return t;return void 0},t.getAttackTime=function(t){return this._parameters[15&t].attackTime},t.setAttackTime=function(t,e){this._parameters[15&t].attackTime=e},t.getDecayTime=function(t){return this._parameters[15&t].decayTime},t.setDecayTime=function(t,e){this._parameters[15&t].decayTime=e},t.getSustainLevel=function(t){return this._parameters[15&t].sustainLevel},t.setSustainLevel=function(t,e){this._parameters[15&t].sustainLevel=e},t.getReleaseTime=function(t){return this._parameters[15&t].releaseTime},t.setReleaseTime=function(t,e){this._parameters[15&t].releaseTime=e},t.getBaseBrightness=function(t){return this._parameters[15&t].baseBrightness},t.setBaseBrightness=function(t,e){this._parameters[15&t].baseBrightness=e},t.isEnabled=function(t){return this._parameters[15&t].enabled},t.setEnabled=function(t,e){this._parameters[15&t].enabled=e},t.getActiveVoices=function(){return this._activeVoices},t.noteOn=function(s,t,n){var e=this._parameters[15&s];if(e.enabled&&t>=this._noteMin&&t<=this._noteMax){var a=this._getVoiceIndex(15&s,127&t),i=this._voices[a];i.channel=15&s,i.note=127&t,i.hsv8=this._midiColors.get(15&s,127&t,127&n),i.adsrEnvelope.noteOn(e.attackTime,e.decayTime,e.sustainLevel,e.releaseTime),i.age=0,this._moveVoice(a)}},t.noteOff=function(e,t){if(this._parameters[15&e].enabled&&t>=this._noteMin&&t<=this._noteMax){var i=this._findVoiceIndex(15&e,127&t);void 0!==i&&this._voices[i].adsrEnvelope.noteOff()}},t.allLedsOff=function(e){for(var t=this._numVoices;t--;)this._voices[t].channel!=(15&e)||this._voices[t].adsrEnvelope.isIdle()||this._voices[t].adsrEnvelope.noteOff()},t.reset=function(t){this._parameters[15&t]=Object.create(i)},t.tick=function(s){this._activeVoices=0;for(var i=this._numVoices;i--;){var t=this._voices[i];if(!t.adsrEnvelope.isIdle()){t.adsrEnvelope.tick(s),t.age++;var e=Math.round(t.hsv8[2]*t.adsrEnvelope.getOutput());e<this._parameters[t.channel].baseBrightness&&(e=this._parameters[t.channel].baseBrightness),this._leds[t.channel][t.note-this._noteMin]=(t.hsv8[0]<<16)+(t.hsv8[1]<<8)+e,this._activeVoices++}}},"function"==typeof define&&define.amd?define(function(){return e}):"object"==typeof module&&module.exports?module.exports=e:this.MidiLeds=e}).call(this),function(){"use strict";function i(){this._state=t.IDLE,this._output=0,this._lastTime=0,this._target=0,this._attackRate=0,this._decayStart=0,this._decayRate=0,this._sustainLevel=0,this._releaseStart=0,this._releaseRate=0,this._releaseTime=0}var t={IDLE:0,ATTACK:1,DECAY:2,SUSTAIN:3,RELEASE:4},e=i.prototype;e.noteOn=function(i,s,e,a){this._state=t.ATTACK,this._output=0,this._lastTime=0,this._target=1,this._attackRate=1/i,this._decayRate=(1-e)/s,this._sustainLevel=e,this._releaseTime=a},e.noteOff=function(){this._state!=t.IDLE&&(this._state=t.RELEASE,this._lastTime=0,this._target=0,this._releaseStart=this._output,this._releaseRate=this._releaseStart/this._releaseTime)},e.tick=function(i){if(this._state!=t.IDLE){0==this._lastTime&&(this._lastTime=i);var e=i-this._lastTime;switch(this._state){case t.ATTACK:return this._output=isFinite(this._attackRate)?e*this._attackRate:this._target,void(this._output>=this._target&&(this._state=t.DECAY,this._output=this._target,this._lastTime=0,this._decayStart=this._target,this._target=this._sustainLevel));case t.DECAY:return this._output=isFinite(this._decayRate)?this._decayStart-e*this._decayRate:this._target,void(this._output<=this._target&&(this._state=t.SUSTAIN,this._output=this._target,this._lastTime=0));case t.SUSTAIN:return this._lastTime=0,void(0==this._output&&(this._state=t.IDLE));case t.RELEASE:return this._output=isFinite(this._releaseRate)?this._releaseStart-e*this._releaseRate:this._target,void(this._output<=this._target&&(this._state=t.IDLE,this._output=this._target,this._lastTime=0))}}},e.getOutput=function(){return this._output},e.isIdle=function(){return this._state==t.IDLE},"function"==typeof define&&define.amd?define(function(){return i}):"object"==typeof module&&module.exports?module.exports=i:this.AdsrEnvelope=i}.call(this),function(){"use strict";function t(i,e){var t=document.createElement("canvas");t.setAttribute("width",Math.floor(i.offsetWidth/e.length)*e.length),t.setAttribute("height",i.offsetHeight),i.appendChild(t),this._canvas={ledWidth:t.getAttribute("width")/e.length,ledHeight:t.getAttribute("height")/1,ctx:t.getContext("2d")},this._leds=e,this._hsv8=new Uint8Array(3),this._rgb8=new Uint8Array(3)}var e=t.prototype;e._hsv8ToRgb8=function(){var c,n,t,i,s,e,_,h,a,r,o;switch(c=this._hsv8[0]/255,n=this._hsv8[1]/255,t=this._hsv8[2]/255,_=Math.floor(6*c),h=6*c-_,a=t*(1-n),r=t*(1-h*n),o=t*(1-(1-h)*n),_%6){case 0:i=t,s=o,e=a;break;case 1:i=r,s=t,e=a;break;case 2:i=a,s=t,e=o;break;case 3:i=a,s=r,e=t;break;case 4:i=o,s=a,e=t;break;case 5:i=t,s=a,e=r}this._rgb8[0]=Math.floor(255*i),this._rgb8[1]=Math.floor(255*s),this._rgb8[2]=Math.floor(255*e)},e.show=function(){for(var t=this._leds.length;t--;){var e=this._leds[t];0==(e>>24&255)&&(this._hsv8[0]=e>>16&255,this._hsv8[1]=e>>8&255,this._hsv8[2]=255&e,this._hsv8ToRgb8(),this._canvas.ctx.fillStyle="rgb("+this._rgb8[0]+","+this._rgb8[1]+","+this._rgb8[2]+")",this._canvas.ctx.fillRect(this._canvas.ledWidth*t,0,this._canvas.ledWidth-1,this._canvas.ledHeight),this._leds[t]|=4278190080)}},"function"==typeof define&&define.amd?define(function(){return t}):"object"==typeof module&&module.exports?module.exports=t:this.CanvasLeds=t}.call(this),function(){"use strict";function t(t,e){this._midiLeds=t,this._midiColors=e,this._timeRange=5e3}var e=t.prototype;e.getTimeRange=function(){return this._timeRange},e.setTimeRange=function(t){this._timeRange=t},e.controlChange=function(i,s,a){var t=15&i,n=127&s,e=127&a;switch(n){case 20:return void this._midiColors.setPalette(t,e);case 21:return void this._midiColors.setColorMap(t,e);case 22:return void this._midiColors.setFixedHue(t,Math.round(255*(e/127)));case 23:return void this._midiLeds.setAttackTime(t,Math.round(this._timeRange*(e/127)));case 24:return void this._midiLeds.setDecayTime(t,Math.round(this._timeRange*(e/127)));case 25:return void this._midiLeds.setSustainLevel(t,1*(e/127));case 26:return void this._midiLeds.setReleaseTime(t,Math.round(this._timeRange*(e/127)));case 27:return void this._midiColors.setIgnoreVelocity(t,64>e?!1:!0);case 28:return void this._midiLeds.setBaseBrightness(t,e);case 29:return void this._midiLeds.setEnabled(t,64>e?!1:!0)}},"function"==typeof define&&define.amd?define(function(){return t}):"object"==typeof module&&module.exports?module.exports=t:this.CCHelper=t}.call(this),function(){"use strict";function e(){this._parameters=new Array(16);for(var t=16;t--;)this.reset(t)}var i={COLOR_MAP:0,RAINBOW:1,FIXED_HUE:2},s={AEPPLI_1940:0,BELMONT_1944:1,BERTRAND_1734:2,BISHOP_1893:3,FIELD_1816:4,HELMHOLTZ_1910:5,JAMESON_1844:6,KLEIN_1930:7,NEWTON_1704:8,RIMINGTON_1893:9,SCRIABIN_1911:10,SEEMANN_1881:11,ZIEVERINK_2004:12},a=[[[0,245,250],[10,240,250],[20,238,248],[32,209,248],[42,192,245],[69,232,220],[96,220,143],[122,207,145],[136,209,156],[150,209,161],[194,227,125],[214,240,125]],[[0,245,250],[9,238,245],[20,238,248],[35,235,248],[42,192,245],[51,192,225],[96,220,143],[122,207,145],[176,230,130],[222,225,168],[231,232,217],[240,235,174]],[[176,230,130],[122,207,145],[96,220,143],[56,189,145],[42,192,245],[34,192,245],[20,238,248],[0,245,250],[0,240,158],[231,232,217],[194,227,125],[214,240,125]],[[0,245,250],[0,240,158],[20,238,248],[35,235,248],[42,192,245],[51,192,225],[96,220,143],[115,197,166],[214,240,125],[231,232,217],[243,225,215],[0,245,250]],[[176,230,130],[196,235,133],[214,240,125],[236,245,192],[0,245,250],[20,238,248],[32,209,248],[42,192,245],[49,220,220],[56,189,145],[76,207,151],[96,220,143]],[[42,192,245],[96,220,143],[122,207,145],[150,209,161],[214,240,125],[231,232,217],[234,232,161],[0,245,250],[7,243,209],[7,243,209],[5,240,248],[19,240,243]],[[0,245,250],[9,238,245],[20,238,248],[34,192,245],[42,192,245],[96,220,143],[122,207,145],[176,230,130],[194,227,125],[214,240,125],[222,225,168],[231,232,217]],[[0,243,194],[0,245,250],[9,238,245],[20,238,248],[42,192,245],[51,192,225],[96,220,143],[122,207,145],[176,230,130],[207,209,135],[231,232,217],[234,232,161]],[[0,245,250],[10,240,250],[20,238,248],[32,209,248],[42,192,245],[96,220,143],[136,227,143],[176,230,130],[196,235,133],[214,240,125],[223,238,176],[231,232,217]],[[0,245,250],[0,240,158],[9,238,245],[20,238,248],[42,192,245],[56,189,145],[96,220,143],[115,197,166],[122,207,145],[214,240,125],[176,230,130],[231,232,217]],[[0,245,250],[231,232,217],[42,192,245],[174,89,133],[150,209,161],[0,240,158],[176,230,130],[20,238,248],[214,240,125],[96,220,143],[174,89,133],[150,209,161]],[[0,186,104],[0,245,250],[20,238,248],[34,192,245],[42,192,245],[96,220,143],[122,207,145],[176,230,130],[214,240,125],[231,232,217],[0,186,104],[0,0,7]],[[51,192,225],[96,220,143],[122,207,145],[176,230,130],[214,240,125],[231,232,217],[231,225,110],[0,240,158],[0,245,250],[20,238,248],[44,110,240],[42,192,245]]],n={noteMin:0,noteMax:127,palette:i.COLOR_MAP,colorMap:s.NEWTON_1704,fixedHue:0,ignoreVelocity:!0},t=e.prototype;t.getNoteMin=function(t){return this._parameters[15&t].noteMin},t.setNoteMin=function(t,e){this._parameters[15&t].noteMin=127&e},t.getNoteMax=function(t){return this._parameters[15&t].noteMax},t.setNoteMax=function(t,e){this._parameters[15&t].noteMax=127&e},t.getPalette=function(t){return this._parameters[15&t].palette},t.setPalette=function(t,e){this._parameters[15&t].palette=e},t.getColorMap=function(t){return this._parameters[15&t].colorMap},t.setColorMap=function(t,e){this._parameters[15&t].colorMap=e},t.getFixedHue=function(t){return this._parameters[15&t].fixedHue},t.setFixedHue=function(t,e){this._parameters[15&t].fixedHue=255&e},t.isIgnoreVelocity=function(t){return this._parameters[15&t].ignoreVelocity},t.setIgnoreVelocity=function(t,e){this._parameters[15&t].ignoreVelocity=e},t.get=function(r,e,o){var t=this._parameters[15&r];if(e<t.noteMin||e>t.noteMax)return void 0;var s=t.ignoreVelocity?127:127&o;switch(t.palette){case i.COLOR_MAP:var n=a[t.colorMap][(127&e)%12];return[n[0],n[1],Math.round(s/127*n[2])];case i.RAINBOW:return[Math.round(((127&e)-t.noteMin)*(255/(t.noteMax-t.noteMin+1))),255,Math.round(s/127*255)];case i.FIXED_HUE:return[t.fixedHue,255,Math.round(s/127*255)]}return void 0},t.reset=function(t){this._parameters[15&t]=Object.create(n)},e.Palettes=i,e.ColorMaps=s,"function"==typeof define&&define.amd?define(function(){return e}):"object"==typeof module&&module.exports?module.exports=e:this.MidiColors=e}.call(this);